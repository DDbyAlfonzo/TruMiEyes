(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[619],{1249:(e,t,a)=>{"use strict";a.d(t,{IG:()=>d,db:()=>c,j2:()=>o});var n=a(6042),r=a(9917),s=a(5226),i=a(2964);let l=(0,n.Dk)().length?(0,n.Dk)()[0]:(0,n.Wp)({apiKey:"AIzaSyXXXXX",authDomain:"trumieyes.firebaseapp.com",projectId:"trumieyes",storageBucket:"trumieyes.appspot.com",messagingSenderId:"1234567890",appId:"1:1234567890:web:abcdefg1234567"}),o=(0,r.xI)(l),d=(0,s.c7)(l),c=(0,i.aU)(l)},2711:(e,t,a)=>{"use strict";let n;a.r(t),a.d(t,{default:()=>b});var r=a(7876),s=a(4232),i=a(1249),l=a(5226),o=a(2964),d=a(9917),c=a(8230),u=a.n(c),p=a(9099);let m={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},h=new Uint8Array(16),f=[];for(let e=0;e<256;++e)f.push((e+256).toString(16).slice(1));let y=function(e,t,a){if(m.randomUUID&&!t&&!e)return m.randomUUID();let r=(e=e||{}).random||(e.rng||function(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(h)})();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){a=a||0;for(let e=0;e<16;++e)t[a+e]=r[e];return t}return function(e,t=0){return f[e[t+0]]+f[e[t+1]]+f[e[t+2]]+f[e[t+3]]+"-"+f[e[t+4]]+f[e[t+5]]+"-"+f[e[t+6]]+f[e[t+7]]+"-"+f[e[t+8]]+f[e[t+9]]+"-"+f[e[t+10]]+f[e[t+11]]+f[e[t+12]]+f[e[t+13]]+f[e[t+14]]+f[e[t+15]]}(r)};function b(){let[e,t]=(0,s.useState)(null),[a,n]=(0,s.useState)(""),[c,m]=(0,s.useState)([]),[h,f]=(0,s.useState)([]),[b,g]=(0,s.useState)(""),[j,w]=(0,s.useState)(!1),[x,I]=(0,s.useState)(0),k=(0,p.useRouter)();(0,s.useEffect)(()=>{let e=(0,d.hg)(i.j2,async e=>{if(e){t(e);let a=(await (0,o.x7)((0,o.H9)(i.db,"users",e.uid))).data();n((null==a?void 0:a.role)||"client"),v((null==a?void 0:a.role)||"client",e.uid)}else k.push("/login")});return()=>e()},[k]);let v=async(e,t)=>{let a="admin"===e?(0,o.rJ)(i.db,"uploads"):(0,o.P)((0,o.rJ)(i.db,"uploads"),(0,o._M)("ownerId","==",t));f((await (0,o.GG)(a)).docs.map(e=>({id:e.id,...e.data()})))},S=async t=>{if(t.preventDefault(),!c.length)return g("Select a file first.");for(let t of(w(!0),c)){let a=t.type.includes("image")?"image":t.type.includes("video")?"video":"pdf",n=(0,l.KR)(i.IG,"uploads/".concat(e.uid,"/").concat(t.name)),r=(0,l.bp)(n,t),s=y().slice(0,8);await new Promise((n,d)=>{r.on("state_changed",e=>{I(e.bytesTransferred/e.totalBytes*100)},d,async()=>{let d=await (0,l.qk)(r.snapshot.ref);await (0,o.gS)((0,o.rJ)(i.db,"uploads"),{name:t.name,url:d,ownerId:e.uid,fileType:a,timestamp:new Date,shareId:s}),n()})})}g("Upload successful!"),m([]),w(!1),v(a,e.uid)},U=async t=>{await (0,o.kd)((0,o.H9)(i.db,"uploads",t.id)),await (0,l.XR)((0,l.KR)(i.IG,"uploads/".concat(t.ownerId,"/").concat(t.name))),v(a,e.uid)},_=async()=>{await (0,d.CI)(i.j2),k.push("/login")};return(0,r.jsx)("div",{className:"overlay",children:(0,r.jsxs)("div",{className:"container",children:[(0,r.jsxs)("div",{className:"top-right",children:[(0,r.jsx)("button",{onClick:_,className:"back-button",children:"Logout"}),(0,r.jsx)(u(),{href:"/",children:(0,r.jsx)("button",{className:"back-button",children:"← Back"})})]}),(0,r.jsx)("h2",{children:"Upload Files"}),"client"===a?(0,r.jsxs)("form",{onSubmit:S,children:[(0,r.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>m([...e.target.files])}),(0,r.jsx)("button",{type:"submit",disabled:j,children:j?"Uploading ".concat(Math.round(x),"%"):"Upload"})]}):(0,r.jsx)("p",{children:"Admins can view all uploads below."}),b&&(0,r.jsx)("p",{style:{color:"white"},children:b}),(0,r.jsx)("div",{className:"gallery",children:h.map(e=>(0,r.jsxs)("div",{className:"thumb",children:["image"===e.fileType&&(0,r.jsx)("img",{src:e.url,alt:e.name}),"video"===e.fileType&&(0,r.jsx)("video",{src:e.url,controls:!0,width:"100%"}),"pdf"===e.fileType&&(0,r.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:e.name}),(0,r.jsx)("p",{children:e.name}),(0,r.jsxs)("p",{style:{fontSize:"0.8rem"},children:["Share link:"," ",(0,r.jsxs)("a",{href:"/share/".concat(e.shareId),target:"_blank",style:{color:"lightblue"},children:["/share/",e.shareId]})]}),"admin"===a&&(0,r.jsx)("button",{onClick:()=>U(e),children:"Delete"})]},e.id))})]})})}},6148:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/upload",function(){return a(2711)}])}},e=>{e.O(0,[671,166,230,697,636,593,792],()=>e(e.s=6148)),_N_E=e.O()}]);